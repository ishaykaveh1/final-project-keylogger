import requests
import base64
from encryption import Encryptor

SERVER_URL = "http://127.0.0.1:5000/api/upload"

if __name__ == "__main__":
    machine_name = "test_machine"
    encryption_key = "A"

    # Dummy log data
    original_data = "Hello from the fake malware client! Just testing :)"

    # Encrypt using your Encryptor
    encryptor = Encryptor(encryption_key)
    encrypted_bytes = encryptor.encrypt(original_data)

    # Base64 encode before sending
    encrypted_b64 = base64.b64encode(encrypted_bytes).decode("utf-8")

    # JSON payload with the Base64 string
    payload = {
        "machine": machine_name,
        "data": encrypted_b64,  # Use the Base64 encoded string here
        "encryption_key": encryption_key
    }

    # Send to server
    try:
        response = requests.post(SERVER_URL, json=payload)
        if response.ok:
            print("Upload successful!")
            print("Server response:", response.json())
        else:
            print("Upload failed:", response.status_code, response.text)
    except Exception as e:
        print("Error connecting to server:", str(e))